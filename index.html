<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>ReactApp</title>
</head>
<body style="background-color: #F2F2F2">
<script src="https://cdn.jsdelivr.net/lodash/4/lodash.min.js"></script>
<script src="https://fb.me/react-15.1.0.js"></script>
<script src="https://fb.me/react-dom-15.1.0.js"></script>
<script src="https://cdn.jsdelivr.net/momentjs/2.14.1/moment-with-locales.min.js"></script>
  <div id="app" ></div>
  <script>
    moment.locale('ru');
    DOM = React.DOM;
    PropTypes = React.PropTypes;

    const posts = [
      {
        id: 1,
        image: {
          src: "https://reactjs.org/logo-og.png",
          alt: "Some text"
        },
        message: "Fisrt message",
        metaInfo: {
          createdAt: new Date(2017, 0, 1, 2, 3, 4),
          createdBy: "Mary",
          updatedAt: new Date(2017, 0, 4, 3, 2, 1)
        },
        likes: 2
      },
      {
        id: 2,
        image: {
          src: "https://reactjs.org/logo-og.png"
        },
        message: "Second message",
        metaInfo: {
          updatedAt: new Date(2017, 0, 1, 2, 3, 4)
        }
      },
      {
        id: 3,
        image: {
          src: "https://reactjs.org/logo-og.png"
        },
        message: "Third message",
        metaInfo: {
          createdAt: new Date(2017, 0, 5, 6, 7, 8),
          createdBy: "Коля",
          updatedAt: new Date(2017, 0, 1, 2, 3, 4)
        },
        likes: 10
      }
    ];

    const TextBox = ({ message }) => (
      DOM.span(
        {
          style: {
            marginLeft: '20px',
          }
        },
        message
      )
    );

    TextBox.defaultProps = {
      message: ""
    };

    TextBox.propTypes = {
      message: PropTypes.string
    };

    const Image = ({ src, width, height, alt }) => (
      DOM.img(
        {
          src: src,
          width: width,
          height: height,
          alt: alt
        }
      )
    );

    Image.defaultProps = {
        src: "https://tasmedes.nl/wp-content/themes/nucleare-pro/images/no-image-box.png",
        width: "70px",
        height:  "40px",
        alt: "No image"
    };

    Image.propTypes = {
      src: PropTypes.string,
      width: PropTypes.string,
      height:  PropTypes.string,
      alt: PropTypes.string
    };

    const BlogItem = ({ id, image, message, metaInfo, likes, addLike }) => (
      DOM.div(
        {
          className: "blog-item",
          style: {
            border: "1px solid #CCCCCC",
            margin: "10px",
            padding: "20px 50px",
            backgroundColor: "white",
            width: "40vw"
          }
        },
        React.createElement(Image, image),
        React.createElement(TextBox, { message }),
        React.createElement(Like, { likes, addLike, id }),
        React.createElement(MetaInfoBlock, metaInfo)
      )
    );

    BlogItem.defaultProps = {
      image: null,
      message: "",
      metaInfo: "",
      likes: 0
    };

    BlogItem.propTypes = {
      image: PropTypes.object,
      message: PropTypes.string,
      metaInfo: PropTypes.object,
      likes: PropTypes.number
    };

    const BlogList = ({ posts, addLike }) => (
      DOM.div(
        {
          className: "blog-list"
        },
        posts.map(
          (post) => (
            React.createElement(
              BlogItem,
              {
                key: post.id,
                id: post.id,
                image: post.image,
                message: post.message,
                metaInfo: post.metaInfo,
                likes: post.likes,
                addLike
              }
            )
          )
        )
      )
    );

    BlogList.defaultProps = {
      posts: null // [{}]
    };

    BlogList.propTypes = {
      posts: PropTypes.array
    };

    class BlogPage extends React.Component {
        constructor(props) {
          super(props);

          this.state = { posts };
          this.addLike = this.addLike.bind(this);
        }

        addLike(id) {
          let { posts } = this.state;
          let post = posts[ posts.findIndex(x => x.id == id)];
          post.likes ? post.likes += 1 : post.likes = 1;
          this.setState({ posts: posts})
        }

        render() {
          return (
            React.createElement(
              BlogList,
              { posts: posts , addLike: this.addLike }
            )
          )
        }
    }

    function dateToString(date) {
      return moment(date).format('MMMM Do YYYY, h:mm:ss');
    };

    const MetaInfoItem = ({ item }) => (
      DOM.li(
        {
          style: {
            listStyleType: 'none',
            margin: '10px',
            color: '#757575'
          }
        },
        item
      )
    );

    MetaInfoItem.defaultProps = {
      item: null
    };

    MetaInfoItem.propTypes = {
      item: PropTypes.oneOfType([ PropTypes.string, PropTypes.date ])
    };

    const MetaInfoBlock = ({ createdAt, createdBy, updatedAt }) => (
      React.createElement(
        "ul",
        {
          style: {
            padding: '0px'
          }
        },
        createdAt && React.createElement( MetaInfoItem, { item: `Созданно: ${ dateToString(createdAt) }` }),
        createdBy && React.createElement( MetaInfoItem, { item: `Автор: ${ createdBy }` }),
        updatedAt && React.createElement( MetaInfoItem, { item: `Обновленно: ${ dateToString(updatedAt) }` })
      )
    );

    MetaInfoBlock.defaultProps = {
      createdAt: null,
      createdBy: "",
      updatedAt: null
    };

    MetaInfoBlock.propTypes = {
      createdAt: PropTypes.oneOfType([ PropTypes.func, PropTypes.date ]),
      createdBy: PropTypes.string,
      updatedAt: PropTypes.oneOfType([ PropTypes.func, PropTypes.date ])
    };

    class Like extends React.Component {

      addLike(id) {
        this.props.addLike(this.props.id);
      }

      render() {
        return (
          DOM.div(
            null,
            DOM.p(null, `Likes: ${ this.props.likes }`),
            DOM.button(
              {
                style: {
                  background: '#51ABC5',
                  border: 'none',
                  borderRadius: '5px',
                  color: 'white',
                  padding: '10px 20px',
                },
                onClick: this.addLike.bind(this)
              },
              "Like"
            )
          )
        )
      }
    };

    // Я так понимаю если компонент создан через класс,
    // то default props указываются в конструкторе
    //
    // Like.defaultProps = {
    //   count: 0
    // };
    //
    // Like.propTypes = {
    //   count: PropTypes.number
    // };

    ReactDOM.render(
      React.createElement(BlogPage, { posts }),
      document.getElementById("app")
    );
  </script>
</body>
</html>
